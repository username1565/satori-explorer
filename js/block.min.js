/*!
 * Cirquity - Cirquity v1.2.0 (https://cirquity.com)
 * Copyright 2020-2020 The Cirquity Developers
 * Licensed under MIT (https://github.com/cirquity/cirquity-explorer/blob/master/LICENSE)
 */

!function(e){let t,a;e((function(){currentPage="block";let t=setInterval((function(){appReady&&(e.getBlock(),clearInterval(t))}),10)})),e.getBlock=function(){t&&t.abort();const o=e.parseJSON(sessionStorage.getItem("searchBlock"));o?e.renderBlock(o):t=e.ajax({url:api+"/json_rpc",method:"POST",data:JSON.stringify({jsonrpc:"2.0",id:"getBlock",method:"f_block_json",params:{hash:e.urlParam("hash")}}),dataType:"json",cache:"false",success:function(t){a=t.result.block,e.renderBlock(a)}}),sessionStorage.removeItem("searchBlock")},e.renderBlock=function(t){e.updateText("block-hash",t.hash),e.updateText("block-height",e.localizeNumber(t.height)),e.updateText("block-timestamp",e.formatDate(t.timestamp)),e.updateText("block-version",t.major_version+"."+t.minor_version),e.updateText("block-difficulty",e.localizeNumber(t.difficulty)),e.updateText("block-orphan",t.orphan_status?"YES":"NO"),e.updateText("block-transactions",t.transactions.length),e.updateText("block-transactionsSize",e.localizeNumber(t.transactionsCumulativeSize)),e.updateText("block-blockSize",e.localizeNumber(t.blockSize)),e.updateText("block-currentTxsMedian",e.localizeNumber(t.sizeMedian)),e.updateText("block-effectiveTxsMedian",e.localizeNumber(t.effectiveSizeMedian)),e.updateText("block-rewardPenalty",100*t.penalty+"%"),e.updateText("block-baseReward",e.getReadableCoins(t.baseReward)),e.updateText("block-transactionsFee",e.getReadableCoins(t.totalFeeAmount)),e.updateText("block-reward",e.getReadableCoins(t.reward)),e.updateText("block-totalCoins",e.getReadableCoins(t.alreadyGeneratedCoins)),e.updateText("block-totalTransactions",e.localizeNumber(t.alreadyGeneratedTransactions)),e.renderTransactions(t.transactions),e.makePrevBlockLink(t.prev_hash),e.ajax({url:api+"/json_rpc",method:"POST",data:JSON.stringify({jsonrpc:"2.0",id:"test",method:"getblockheaderbyheight",params:{height:t.height+1}}),dataType:"json",cache:"false",success:function(t){if(t.result){let a=t.result.block_header.hash;a&&e.makeNextBlockLink(a)}},error:function(e){}})},e.renderTransactions=function(t){let a=e("#transactions-rows");for(let o=0;o<t.length;o++){let n=t[o],r=JSON.stringify(n),i=document.getElementById("transactionRow"+n.hash);if(i&&i.getAttribute("data-json")!==r)e(i).replaceWith(e.getTransactionRowElement(n,r));else if(!i){let t=e.getTransactionRowElement(n,r);a.append(t)}}},e.getTransactionRowElement=function(t,a){let o=document.createElement("tr");return o.setAttribute("data-json",a),o.setAttribute("data-hash",t.hash),o.setAttribute("id","transactionRow"+t.hash),o.innerHTML=e.getTransactionCells(t),o},e.getTransactionCells=function(t){return'<th scope="row">'+e.formatPaymentLink(t.hash)+"</th><td>"+e.getReadableCoins(t.fee,4,!0)+"</td><td>"+e.getReadableCoins(t.amount_out,4,!0)+"</td><td>"+e.localizeNumber(t.size)+"</td>"},e.makeNextBlockLink=function(t){e("#block_height").append(' <a href="'+e.getBlockchainUrl(t)+'" title="Next block"><i class="fa fa-chevron-circle-right" aria-hidden="true"></i></a>')},e.makePrevBlockLink=function(t){e("#block_height").prepend('<a href="'+e.getBlockchainUrl(t)+'" title="Previous block"><i class="fa fa-chevron-circle-left" aria-hidden="true"></i></a> ')}}(jQuery);
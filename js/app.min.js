/*!
 * Cirquity - Cirquity v1.1.0 (https://cirquity.com)
 * Copyright 2020-2020 The Cirquity Developers
 * Licensed under MIT (https://github.com/cirquity/cirquity-explorer/blob/master/LICENSE)
 */

const blockchainExplorer="block.html?hash={id}",transactionExplorer="transaction.html?hash={id}",paymentIdExplorer="paymentid.html?hash={id}";let lastStats,appReady=!1,currentPage="home",numberFormatter=new Intl.NumberFormat("en-US");!function(t){t((function(){t(window).on("scroll load",(function(){t(window).scrollTop()>5?t(".navbar").addClass("active"):t(".navbar").removeClass("active"),t(window).scrollTop()>1e3?t("#scrollTop").addClass("active"):t("#scrollTop").removeClass("active")})),t("#scrollTop").on("click",(function(e){e.preventDefault(),t("html, body").animate({scrollTop:0},1e3)})),t("#search-text").keyup((function(e){13===e.keyCode&&t("#search-button").click()})),t("#search-button").click((function(e){let a=t("#search-text").val();a.length<64?t.GetSearchBlockByHeight(a):64===a.length?t.GetSearchBlock(a):t.wrongSearchAlert(a),e.preventDefault()})),void 0!==donationAddress&&""!==donationAddress&&(t("#donation").show(),t("#donation-address").html(donationAddress)),t.fetchLiveStats(!0)})),t.pulseLiveUpdate=function(){let e=t("stats-updated");e.css({transition:"opacity 100ms ease-out",opacity:1}),setTimeout((function(){e.css({transition:"opacity 7000ms linear",opacity:0})}),500)},t.fetchLiveStats=function(e=!1){t.ajax({url:api+"/info",dataType:"json",type:"GET",cache:"false"}).done((function(a){t.pulseLiveUpdate(),lastStats=a,e?appReady=!0:("home"===currentPage&&t.updateHome(),"pool"===currentPage&&t.updatePool())})).always((function(){setTimeout((function(){t.fetchLiveStats()}),refreshDelay)}))},t.urlParam=function(t){const e=new RegExp("[?&]"+t+"=([^&#]*)").exec(window.location.href);return null==e?null:e[1]||0},t.localizeNumber=function(t){return numberFormatter.format(t)},t.updateText=function(e,a){const n=t("#"+e);return n.text()!==a&&n.text(a),n},t.updateTextLinkable=function(e,a){const n=t("#"+e);return n.html()!==a&&n.html(a),n},t.renderDate=function(t){return t.getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getDate()).slice(-2)+" "+("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)+":"+("0"+t.getSeconds()).slice(-2)},t.formatDate=function(e){return e?t.renderDate(new Date(1e3*parseInt(e))):""},t.formatBlockLink=function(e){return'<a href="'+t.getBlockchainUrl(e)+'">'+e+"</a>"},t.formatPaymentLink=function(e){return'<a href="'+t.getTransactionUrl(e)+'">'+e+"</a>"},t.getBlockchainUrl=function(t){return blockchainExplorer.replace("{id}",t)},t.getTransactionUrl=function(t){return transactionExplorer.replace("{symbol}",symbol.toLowerCase()).replace("{id}",t)},t.getReadableDifficultyString=function(e,a){if(isNaN(parseFloat(e))||!isFinite(e))return 0;void 0===a&&(a=0);const n=["","k","M","G","T","P"],o=Math.floor(Math.log(e)/Math.log(1e3));return null==n[o]?0:t.localizeNumber((e/Math.pow(1e3,Math.floor(o))).toFixed(a))+" "+n[o]},t.getReadableHashRateString=function(e){let a=0;for(;e>1e3;)e/=1e3,a++;return t.localizeNumber(e.toFixed(2))+[" H"," kH"," MH"," GH"," TH"," PH"," EH"," ZH"," YH"][a]},t.getReadableCoins=function(e,a,n){const o=parseInt(e||0)/coinUnits,r=Math.floor(o),s=""+o;let i="";return s.indexOf(".")>-1?(i=s.substr(s.indexOf(".")+1,s.length-s.indexOf(".")+1),i=i.substr(0,a||coinDisplayDecimals),1===i.length&&(i+="0")):i="00",t.localizeNumber(r)+"."+i+(n?"":" "+symbol)},t.hex2a=function(t){const e=t.toString();let a="";for(let t=0;t<e.length;t+=2)a+=String.fromCharCode(parseInt(e.substr(t,2),16));return a},t.validHex=function(t){return new RegExp("[0-9a-fA-F]{"+t.length+"}").test(t)},t.GetSearchBlockByHeight=function(e){let a,n;n&&n.abort(),n=t.ajax({url:api+"/json_rpc",method:"POST",data:JSON.stringify({jsonrpc:"2.0",id:"blockbyheight",method:"getblockheaderbyheight",params:{height:parseInt(e)}}),dataType:"json",cache:"false",success:function(e){e.result?(a=e.result.block_header,window.location.href=t.getBlockchainUrl(a.hash)):e.error&&t.wrongSearchAlert()}})},t.GetSearchBlock=function(e){let a,n;n&&n.abort(),n=t.ajax({url:api+"/json_rpc",method:"POST",data:JSON.stringify({jsonrpc:"2.0",id:"GetSearchBlock",method:"f_block_json",params:{hash:e}}),dataType:"json",cache:"false",success:function(n){n.result?(a=n.result.block,sessionStorage.setItem("searchBlock",JSON.stringify(a)),window.location.href=t.getBlockchainUrl(a.hash)):n.error&&t.ajax({url:api+"/json_rpc",method:"POST",data:JSON.stringify({jsonrpc:"2.0",id:"test",method:"f_transaction_json",params:{hash:e}}),dataType:"json",cache:"false",success:function(a){if(a.result)sessionStorage.setItem("searchTransaction",JSON.stringify(a.result)),window.location.href=transactionExplorer.replace("{id}",e);else if(a.error){t.ajax({url:api+"/json_rpc",method:"POST",data:JSON.stringify({jsonrpc:"2.0",id:"test",method:"k_transactions_by_payment_id",params:{payment_id:e}}),dataType:"json",cache:"false",success:function(a){if(a.result){let t=a.result.transactions;sessionStorage.setItem("txsByPaymentId",JSON.stringify(t)),window.location.href=paymentIdExplorer.replace("{id}",e)}else a.error&&t("main").after('<div class="alert alert-warning alert-dismissible fade in show" style="position: fixed; right: 50px; top: 50px;"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>We could not find anything.</div>')}})}}})}})},t.wrongSearchAlert=function(){t("main").after('<div class="alert alert-danger alert-dismissible fade in show" style="position: fixed; right: 50px; top: 50px;"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>Wrong search query!</strong><br /> Please enter block height or hash, transaction hash, or payment id.</div>')}}(jQuery);
/*!
 * Satori - Satori v1.2.0 (https://Satori.gold)
 * Copyright 2020-2020 The Satori Developers
 * Licensed under MIT (https://github.com/uwxpro/Satori-explorer/blob/master/LICENSE)
 */

!function(e){let t,r=e("#transaction-hash"),o=e("#private-key"),n=e("#public-address"),a=e("#txn-link"),s=e("#outputs-rows"),l=new TurtleCoinUtils.CryptoNote({coinUnitPlaces:2,addressPrefix:3934293,keccakIterations:1,defaultNetworkFee:10,fusionMinInputCount:12,fusionMinInOutCountRatio:4,mmMiningBlockVersion:2,maximumOutputAmount:1e11,maximumOutputsPerTransaction:90,maximumExtraSize:1024,activateFeePerByteTransactions:!1,feePerByte:1.953125,feePerByteChunkSize:256});e((function(){currentPage="check";let t=setInterval((function(){appReady&&clearInterval(t)}),10);e("#check-transaction").click((function(){e.getTxn(r.val(),(function(t){if(t.error)alert(t.error.message);else{const l="view",i=e.checkTxn(t.result,o.val(),n.val(),l);if(i.error)a.attr("href",""),a.html("?"),alert(i.error);else{a.attr("href","transaction.html?hash="+r.val()),a.html(r.val()),s.html("");for(let e in i.owned)if(i.owned.hasOwnProperty(e)){let t=i.owned[e],r="<tr><td>"+t[2]+"</td><td>"+t[1]+"</td></tr>";s.append(r)}}}}))}))})),e.getTxn=function(r,o){t&&t.abort(),t=e.ajax({url:api+"/json_rpc",method:"POST",data:JSON.stringify({jsonrpc:"2.0",id:"blockexplorer",method:"f_transaction_json",params:{hash:r}}),dataType:"json",error:function(e){alert(e.error)},success:o})},e.checkTxn=function(t,r,o,n){let a=t.tx,s=t.txDetails,i=l.decodeAddress(o),c=s.hash,d={error:!1,total_owned:0,owned:[],unowned:[]};console.log(i.rawAddress,i,a);if(console.log(8),64!==r.length||!0!==e.validHex(r))d.error="Invalid private key";else if(99!==o.length||i.rawAddress.slice(-8)!==cn_fast_hash(i.rawAddress.slice(0,-8)).slice(0,8))d.error="Bad address";else if("view"===n&&i.rawAddress.slice(72,136)!==sec_key_to_pub(r))d.error="Secret View key does not match address";else if(64===c.length&&e.validHex(c)){let t=i.rawAddress.slice(72,136);"view"===n&&(console.log(a.extra),t=e.pubKeyFromExtra(hextobin(a.extra)),console.log("pub",t));let o=generate_key_derivation(t,r),s=i.rawAddress.slice(8,72);console.log("der=",o," spk",s),console.log(a.vout.length);for(let e=0;e<a.vout.length;e++){let t=derive_public_key(o,e,s);console.log(t,a.vout[e].target.data.key);let r=a.vout[e].amount/1e8;t===a.vout[e].target.data.key?(d.total_owned+=r,d.owned.push([e,t,r])):d.unowned.push([e,a.vout[e].target.key,r])}}else d.error="Invalid TXN Hash";return console.log(d),d},e.pubKeyFromExtra=function(e){let t=!1;for(console.log("bin",e);e.length>0&&0===e[0];)e=e.slice(1,e.length);return 1===e[0]&&e.length>=48&&(t=e.slice(1,48)),t}}(jQuery);

/*!
 * Cirquity - Cirquity v1.2.0 (https://cirquity.com)
 * Copyright 2020-2020 The Cirquity Developers
 * Licensed under MIT (https://github.com/cirquity/cirquity-explorer/blob/master/LICENSE)
 */

!function(t){let e;t((function(){currentPage="transaction";let e=setInterval((function(){appReady&&(t.getTransaction(),clearInterval(e))}),10)})),t.getTransaction=function(){e&&e.abort();const n=t.parseJSON(sessionStorage.getItem("searchTransaction"));n?t.renderTransaction(n):e=t.ajax({url:api+"/json_rpc",method:"POST",data:JSON.stringify({jsonrpc:"2.0",id:"test",method:"f_transaction_json",params:{hash:t.urlParam("hash")}}),dataType:"json",cache:"false",success:function(e){const n=e.result;e.error&&""!==e.error.message?t.ajax({url:api+"/get_transaction_details_by_hashes",method:"POST",data:JSON.stringify({transactionHashes:[t.urlParam("hash")]}),dataType:"json",cache:"false",success:function(e){const n=e.transactions[0];"OK"===e.status?t.renderMemPoolTransaction(n):(console.log(e.status),alert(e.status))}}):t.renderTransaction(n)}}),sessionStorage.removeItem("searchTransaction")},t.renderTransaction=function(e){const n=e.txDetails;inputs=e.tx.vin,outputs=e.tx.vout,block=e.block,t.updateText("transaction-hash",n.hash),block.hash&&(t("#confirmations").removeClass("d-none"),t.updateText("transaction-confirmations",t.localizeNumber(lastStats.height-block.height)),t.updateText("transaction-timestamp",t.formatDate(block.timestamp))),t.updateText("transaction-amount_out",t.getReadableCoins(n.amount_out)),t.updateText("transaction-fee",t.getReadableCoins(n.fee)),t.updateText("transaction-mixin",n.mixin),t.updateText("transaction-paymentId",n.paymentId),t.updateText("transaction-paymentIdDecipher",t.hex2a(n.paymentId)),n.paymentId||(t("#div_transaction_paymentId").addClass("d-none"),t("#div_transaction_paymentIdDecipher").addClass("d-none")),t.updateText("transaction-size",t.localizeNumber(n.size)),block.hash||(t("#tx_block").addClass("d-none"),t("#tx_unconfirmed").removeClass("d-none")),t.updateTextLinkable("block-hash",t.formatBlockLink(block.hash)),t.updateText("block-height",t.localizeNumber(block.height)),t.updateText("block-timestamp",t.formatDate(block.timestamp)),t.renderInputs(inputs),t.renderOutputs(outputs)},t.renderMemPoolTransaction=function(e){inputs=e.inputs,outputs=e.outputs,t.updateText("transaction-hash",e.hash),e.inBlockchain&&(t("#confirmations").removeClass("d-none"),t.updateText("transaction-confirmations",t.localizeNumber(lastStats.height-e.blockIndex)),t.updateText("transaction-timestamp",t.formatDate(e.timestamp))),t.updateText("transaction-amount_out",t.getReadableCoins(e.totalOutputsAmount)),t.updateText("transaction-fee",t.getReadableCoins(e.fee)),t.updateText("transaction-mixin",e.mixin),t.updateText("transaction-paymentId","0000000000000000000000000000000000000000000000000000000000000000"===e.paymentId?"":e.paymentId),t.updateText("transaction-paymentIdDecipher",t.hex2a(e.paymentId)),e.paymentId&&"0000000000000000000000000000000000000000000000000000000000000000"!==e.paymentId||(t("#div_transaction_paymentId").addClass("d-none"),t("#div_transaction_paymentIdDecipher").addClass("d-none")),t.updateText("transaction-size",t.localizeNumber(e.size)),e.inBlockchain||(t("#tx_block").addClass("d-none"),t("#tx_unconfirmed").removeClass("d-none")),t.renderMemPoolInputs(inputs),t.renderMemPoolOutputs(outputs)},t.renderInputs=function(e){const n=t("#inputs-rows");for(let a=0;a<e.length;a++){let o=e[a];if(!o.value.amount)continue;let s=JSON.stringify(o),u=document.getElementById("inputRow"+o.value.k_image);if(u&&u.getAttribute("data-json")!==s)t(u).replaceWith(t.getInputRowElement(o,s));else if(!u){let e=t.getInputRowElement(o,s);n.append(e)}}t.updateText("inputs-count",document.querySelectorAll("#inputs-rows tr").length)},t.renderOutputs=function(e){const n=t("#outputs-rows");for(let a=0;a<e.length;a++){let o=e[a],s=JSON.stringify(o),u=document.getElementById("outputRow"+o.target.data.key);if(u&&u.getAttribute("data-json")!==s)t(u).replaceWith(t.getOutputRowElement(o,s));else if(!u){let e=t.getOutputRowElement(o,s);n.append(e)}}t.updateText("outputs-count",document.querySelectorAll("#outputs-rows tr").length)},t.getInputRowElement=function(e,n){const a=document.createElement("tr");return a.setAttribute("data-json",n),a.setAttribute("data-k_image",e.value.k_image),a.setAttribute("id","inputRow"+e.value.k_image),a.innerHTML=t.getInputCells(e),a},t.getOutputRowElement=function(e,n){let a=document.createElement("tr");return a.setAttribute("data-json",n),a.setAttribute("data-k_image",e.target.data.key),a.setAttribute("id","outputRow"+e.target.data.key),a.innerHTML=t.getOutputCells(e),a},t.getInputCells=function(e){return'<th scope="row">'+t.getReadableCoins(e.value.amount)+"</th><td>"+e.value.k_image+"</td>"},t.getOutputCells=function(e){return'<th scope="row">'+t.getReadableCoins(e.amount)+"</th><td>"+e.target.data.key+"</td>"},t.renderMemPoolInputs=function(e){let n=t("#inputs-rows");for(let a=0;a<e.length;a++){let o=e[a].data;if(!o.input.amount)continue;let s={type:o.type,value:{amount:o.input.amount,k_image:o.input.k_image,key_offsets:o.input.key_offsets}},u=JSON.stringify(s),i=document.getElementById("inputRow"+s.value.k_image);if(i&&i.getAttribute("data-json")!==u)t(i).replaceWith(t.getInputRowElement(s,u));else if(!i){let e=t.getInputRowElement(s,u);n.append(e)}}t.updateText("inputs-count",document.querySelectorAll("#inputs-rows tr").length)},t.renderMemPoolOutputs=function(e){let n=t("#outputs_rows");for(let a=0;a<e.length;a++){let o=e[a].output,s={amount:o.amount,target:o.target},u=JSON.stringify(s),i=document.getElementById("outputRow"+s.target.data.key);if(i&&i.getAttribute("data-json")!==u)t(i).replaceWith(t.getOutputRowElement(s,u));else if(!i){let e=t.getOutputRowElement(s,u);n.append(e)}}t.updateText("outputs-count",document.querySelectorAll("#outputs-rows tr").length)}}(jQuery);